<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vue 2 optionMergeStrategies 详解</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>

<body>
  <div id="root"></div>
  <script>
    // 自定义一个方法
    const fn = (name, vm) => {
      const lifeCycles = vm.$options[name]
      if (lifeCycles && lifeCycles.length) {
        lifeCycles.forEach(lc => lc.call(vm));
      }
      // 子组件同样可以使用当前的自定义选项合并
      const children = vm.$children
      if (children && children.length) {
        children.forEach(child => fn(name, child))
      }
    }

    const bind = vm => {
      // 监听一下window窗口的进入和离开事件
      window.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'hidden') {
          fn('notInCurrentWindow', vm)
        }
      })
    }

    // 子组件
    Vue.component('my-child', {
      template: `<div>我是子组件</div>`,
      notInCurrentWindow() {
        alert('子组件：离开当前页面')
      }
    })

    const vm = new Vue({
      el: document.querySelector('#root'),
      template: `
        <div>
          <h1>hello world !</h1>
          <my-child></my-child>
        </div>
      `,
      notInCurrentWindow() {
        alert('根组件：离开当前页面')
      },
      created() {
        // 这里仅做演示
        // alert('created 钩子')
      },
    })

    // 把自定义选项合并注入到Vue实例
    bind(vm)
  </script>
</body>

</html>